<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no,minimal-ui" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="renderer" content="webkit" />
    <meta name="full-screen" content="yes" />
    <meta name="x5-fullscreen" content="true" />
    <meta name="format-detection" content="telphone=no, email=no" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
	<title>课程介绍</title>
	<link rel="stylesheet" type="text/css" href="css/customstyle.css"/>
	<script src="js/iScroll.js"></script>
	<!--api.js和WXPay.js必须放在Mdate.js前面-->
	<script src="js/config/api.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/custom/CourseWXPay.js" type="text/javascript" charset="utf-8"></script>
    <!--<script src="js/Mdate.js"></script>-->
		<style>
			.course_details_img{
				margin-top: 1rem;
			}
			.course_details_img img{
				width: 100%;
				height: auto;
			}
			.course_introduce{
				font-size:1.13rem;
				font-family:PingFangSC-Semibold;
				font-weight:600;
				color:rgba(51,51,51,1);
				padding-bottom: 1rem;
			}
		</style>
		
		<script>
			var h_8em = document.getElementById("background");
			h_8em.classList.remove("rel", "ovh", "bg_white2");
			h_8em.classList.add("rel", "ovh", "bg_white");
		</script>
	</head>
	<body>
		<!--<div class="header">
			<div class="header_1">
				<div class="course_name" id="course_name">
					<input type="hidden" id="course_derc" value="" />
				</div>
				<div class="course_price" id="course_price">
					
				</div>
			</div>
			<div class="header_2">
				<div class="course_mode" id="course_mode">
					
				</div>
				<div class="course_learing" id="course_learing">
					
				</div>
			</div>
		</div>-->
		<!--<div class="module list press mt_5">
            <ul class="list_h_36em" id="course_hard_list">
              <li class="bor_bottom bor_gray_ddd bg_white">
                <dl class="ovh h_in">
                  <dt class="fl ovh ml_3 mr_03em">综合难度&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</dt>
                  <dd class="fl ovh">
                    <div class="line_h_in ovh">
                      <span id="plug_ratyli2" data-rate="3" data-ratemax="4">
                      	<span><i class="c_gray_ccc text_18em line_h_2em icon-mn_xingxing_fill mr_05em"></i></span>
                      	<span><i class="c_gray_ccc text_18em line_h_2em icon-mn_xingxing_fill mr_05em"></i></span>
                      	<span><i class="c_gray_ccc text_18em line_h_2em icon-mn_xingxing_fill mr_05em"></i></span>
                      	<span><i class="c_gray_ccc text_18em line_h_2em icon-mn_xingxing_fill mr_05em"></i></span>
                      	<span><i class="c_gray_ccc text_18em line_h_2em icon-mn_xingxing_fill mr_05em"></i></span>
                      </span>
                    </div>
                  </dd>
                </dl>
              </li>
              <li class="bor_bottom bor_gray_ddd bg_white">
                <dl class="ovh h_in">
                  <dt class="fl ovh ml_3 mr_03em">理论知识&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</dt>
                  <dd class="fl ovh">
                    <div class="line_h_in ovh">
                      <span id="plug_ratyli2" data-rate="3" data-ratemax="4">
                      	<span><i class="c_gray_ccc text_18em line_h_2em icon-mn_xingxing_fill mr_05em"></i></span>
                      	<span><i class="c_gray_ccc text_18em line_h_2em icon-mn_xingxing_fill mr_05em"></i></span>
                      	<span><i class="c_gray_ccc text_18em line_h_2em icon-mn_xingxing_fill mr_05em"></i></span>
                      	<span><i class="c_gray_ccc text_18em line_h_2em icon-mn_xingxing_fill mr_05em"></i></span>
                      	<span><i class="c_gray_ccc text_18em line_h_2em icon-mn_xingxing_fill mr_05em"></i></span>
                      </span>
                    </div>
                  </dd>
                </dl>
              </li>
              <li class="bor_bottom bor_gray_ddd bg_white">
                <dl class="ovh h_in">
                  <dt class="fl ovh ml_3 mr_03em">实战操作&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</dt>
                  <dd class="fl ovh">
                    <div class="line_h_in ovh">
                      <span id="plug_ratyli2" data-rate="3" data-ratemax="4">
                      	<span><i class="c_gray_ccc text_18em line_h_2em icon-mn_xingxing_fill mr_05em"></i></span>
                      	<span><i class="c_gray_ccc text_18em line_h_2em icon-mn_xingxing_fill mr_05em"></i></span>
                      	<span><i class="c_gray_ccc text_18em line_h_2em icon-mn_xingxing_fill mr_05em"></i></span>
                      	<span><i class="c_gray_ccc text_18em line_h_2em icon-mn_xingxing_fill mr_05em"></i></span>
                      	<span><i class="c_gray_ccc text_18em line_h_2em icon-mn_xingxing_fill mr_05em"></i></span>
                      </span>
                    </div>
                  </dd>
                </dl>
              </li>
              <li class="bor_bottom bor_gray_ddd bg_white">
                <dl class="ovh h_in">
                  <dt class="fl ovh ml_3 mr_03em">社交互动&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</dt>
                  <dd class="fl ovh">
                    <div class="line_h_in ovh">
                      <span id="plug_ratyli2" data-rate="3" data-ratemax="4">
                      	<span><i class="c_gray_ccc text_18em line_h_2em icon-mn_xingxing_fill mr_05em"></i></span>
                      	<span><i class="c_gray_ccc text_18em line_h_2em icon-mn_xingxing_fill mr_05em"></i></span>
                      	<span><i class="c_gray_ccc text_18em line_h_2em icon-mn_xingxing_fill mr_05em"></i></span>
                      	<span><i class="c_gray_ccc text_18em line_h_2em icon-mn_xingxing_fill mr_05em"></i></span>
                      	<span><i class="c_gray_ccc text_18em line_h_2em icon-mn_xingxing_fill mr_05em"></i></span>
                      </span>
                    </div>
                  </dd>
                </dl>
              </li>
            </ul>
        </div>-->
        <div class="course_derc">
        	<div class="course_introduce">
        		课程介绍
        	</div>
        	<p id="course_derc">我叫风胡子，是一名心理学培训师，同时也是一名父亲，擅长将心理学的研究成果融合亲子之间的琐碎事件，以便为解决为人父母的小烦恼提供科学的切入点。</p>
        </div>
        <div class="course_details_img" id="course_details_img">
        	<img src="" />
        </div>
	</body>
	<script src="js/custom/tip.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		/**
		 * 从localStorage中获取课程信息
		 * courseDetails 课程json数据对象
		 * chapterList 课程章节集合
		 * courseDetailImgList 课程详情图集合
		 */
		var courseDetails = JSON.parse(window.localStorage.getItem("courseDetails"));
		var chapterList = courseDetails.courseChapterList;
		var courseDetailImgList = courseDetails.courseDetailImgList;
		this.courseCourseDetails(courseDetailImgList);
		$("#course_derc").html(courseDetails.courseDerc);
		
		function courseCourseDetails(courseDetailImgList){
			$("#course_details_img img").remove();
			var dom = "";
			for(var i = 0; i < courseDetailImgList.length; i++ ){
				var itemVO = courseDetailImgList[i];
				dom += "<img src='"+itemVO.imgUrl+"' />";
				
			}
			$("#course_details_img").append(dom);
			console.log("dom="+dom)
		}
		//开课时间(在Mdate.js中设置)
		//var timeList = JSON.parse(window.localStorage.getItem("daniuCourseBeginTimeList"));
		
		//根据courseId查询用户是否购买了该课程，根据购买状态控制底部试听和立即购买按钮的现实与隐藏
		/**
		 * isFree 是否有试看章节
		 * freeChapters 试看章节数量
		 * j 用于循环控制状态的参数
		 * isbuy 是否购买
		 */
		var isFree = "N";
		var freeChapters = 0;
		var j = 0;
		var isbuy = "N";
		var userInfo = JSON.parse(window.localStorage.getItem("userInfo"));
		console.log("课程详情页面userId="+userInfo.userId);
		console.log("课程详情页面courseId="+courseDetails.courseId);
		
		//查询用户是否购买该课程
		$.ajax({
			async:false,
			type:"post",
			url:apiPath.userPath,
			xhrFields:{withCredentials:true},
			data:{
				"method":user.get('learning'),
				"courseId":courseDetails.courseId,
				"userId":userInfo.userId,
				"userCourseStatus":"0"//"0"表示已购买
			},
			success:function(data){
				console.log("data.code="+data.code)
				if(data.code == 0 && getJsonLength(data) > 0){
					isbuy = "Y";
				}else if(data.code == 500){
					alert("接口请求出错");
					isbuy = "N";
				}else{
					isbuy = "N";
				}
				window.localStorage.setItem("isbuy",isbuy);
			}
		});
		console.log("isbuy="+isbuy)
		if(isbuy == "Y"){
			$(".learing_at_once").css("display","flex");
		}else{
			$(".btn").css("display","flex");
		}
		
		//统计免费试看章节数量并以此判断是否可以试看
		for(var i=0;i<chapterList.length;i++) {
			if (chapterList[i].freeYn == "Y") {
				freeChapters++;
			}
		}
		if(freeChapters > 0){//此时的isFree和freeChapters为实际的值
			isFree = "Y";
			window.localStorage.setItem("isFree",isFree);
			window.localStorage.setItem("freeChapters",freeChapters);
		}else{//此时的isFree和freeChapters为默认的0
			window.localStorage.setItem("isFree",isFree);
			window.localStorage.setItem("freeChapters",freeChapters);
		}
			
		console.log("是否有试看章节="+isFree+" 试看章节数量="+freeChapters+" 是否购买="+isbuy)
		
		
	</script>

</html>